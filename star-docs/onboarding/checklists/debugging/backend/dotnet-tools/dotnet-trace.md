# dotnet-trace
برای بررسی و تحلیل عملکرد دقیق‌تر برنامه‌های 
.NET
می‌توان از ابزار
`dotnet-trace`
استفاده کرد.

## نصب ابزار
برای نصب این ابزار روی سیستم خود از دستور زیر استفاده کنید.

```bash
dotnet tool install --global dotnet-trace
```

## شروع به ردیابی
برای شروع به ردیابی عملکرد یک پردازش خاص، ابتدا نیاز است تا
`Process ID`
آن پردازش را پیدا کنید. می‌توانید از ابزار
`dotnet-counters`
یا دستور
`ps`
در
Linux
یا
`tasklist`
در
Windows
برای یافتن
`PID`
استفاده کنید.

سپس برای شروع ردیابی از دستور زیر استفاده کنید:

```bash
dotnet-trace collect -p <PID>
```

این دستور خروجی مشابه زیر خواهد داشت که در آن عملیات ردیابی شروع می‌شود و داده‌ها ذخیره می‌شوند.

## مشاهده‌ی داده‌های ردیابی
برای مشاهده‌ی داده‌های ردیابی ذخیره شده می‌توانید از ابزارهایی مانند
`perfview`
یا
`speedscope`
استفاده کنید.

## فرمت خروجی
می‌توان داده‌های ردیابی را به فرمت‌های مختلفی خروجی گرفت که یکی از رایج‌ترین آن‌ها
`nettrace`
است. همچنین می‌توان خروجی را به فرمت
`speedscope`
نیز تهیه کرد.

```bash
dotnet-trace collect -p <PID> --format speedscope
```

## تحلیل و بررسی
برای تحلیل و بررسی داده‌های ردیابی می‌توانید از دستور زیر استفاده کنید که یک مرورگر را باز کرده و داده‌های ردیابی را نمایش می‌دهد.

```bash
dotnet-trace convert -f speedscope <trace-file>
```

## مثال عملی: رفع باگ عملکردی
در این بخش، یک مثال عملی برای ردیابی و رفع باگ عملکردی یک برنامه
.NET
را گام به گام توضیح می‌دهیم.

### مرحله 1: شناسایی مشکل
فرض کنید یک برنامه وب
ASP.NET Core
دارید که گاهی اوقات به طور غیرمنتظره‌ای کند می‌شود. ابتدا باید
`Process ID (PID)`
این برنامه را پیدا کنید.

```bash
dotnet-trace ps
```

### مرحله 2: شروع به ردیابی
پس از پیدا کردن
`PID`
، از دستور زیر برای شروع ردیابی استفاده کنید.

```bash
dotnet-trace collect -p <PID>
```

این دستور عملیات ردیابی را شروع کرده و داده‌های عملکردی را ذخیره می‌کند.

### مرحله 3: تولید بار کاری
برای شبیه‌سازی شرایطی که برنامه کند می‌شود، بار کاری مشابه شرایط واقعی را به برنامه وارد کنید.

### مرحله 4: متوقف کردن ردیابی
پس از تولید بار کاری و شناسایی نقاط کند، ردیابی را متوقف کنید.

```bash
Ctrl + C
```

### مرحله 5: تحلیل داده‌ها
داده‌های جمع‌آوری شده را با استفاده از ابزارهای تحلیل مانند
`perfview`
یا
`speedscope`
باز کنید و بررسی کنید.

```bash
dotnet-trace convert -f speedscope trace.nettrace
speedscope trace.speedscope.json
```

### مرحله 6: شناسایی علت مشکل
در این مرحله، داده‌های ردیابی را تحلیل کرده و بخش‌هایی از کد که بیشترین زمان اجرا را به خود اختصاص داده‌اند شناسایی کنید. به عنوان مثال، ممکن است متوجه شوید که یک تابع خاص در کد شما زمان زیادی برای اجرا صرف می‌کند.

### مرحله 7: رفع باگ
با توجه به تحلیل داده‌ها، تغییرات لازم را در کد اعمال کنید. مثلاً اگر یک کوئری به پایگاه داده بهینه نیست، آن را بهینه کنید.

### مرحله 8: اعتبارسنجی رفع باگ
پس از اعمال تغییرات، مجدداً برنامه را تحت بار کاری قرار داده و با استفاده از
`dotnet-trace`
ردیابی کنید تا مطمئن شوید مشکل برطرف شده است.

## منابع بیشتر
برای آشنایی بیشتر با ابزار
`dotnet-trace`
و کاربردهای آن می‌توانید به منابع زیر مراجعه کنید:

- [مستندات رسمی dotnet-trace](https://learn.microsoft.com/en-us/dotnet/core/diagnostics/dotnet-trace)

## جمع‌بندی
ابزار
`dotnet-trace`
یک ابزار قدرتمند برای ردیابی و تحلیل عملکرد برنامه‌های
.NET
است که به شما کمک می‌کند تا با شناسایی مشکلات و بهینه‌سازی عملکرد برنامه‌های خود، بهره‌وری و کارایی بهتری داشته باشید.